PROBLEM: Recently accessing to Gmail become a nightmare, so I want a fetchmail to get the mails for me when the network is OK, and I do not want to send mail by gmail, but by  msmtp on my own machine. And of cuourse a textual mail reader is nicer than GUI, so mutt!

# this is everything you need to work with gmail
procmail fetchmail and mutt, but not sendmail info here:

    http://www.andrews-corner.org/mutt.html

# fetchmail

.fetchmailrc

    poll pop.gmail.com
    with proto POP3
    user 'happypeter1983'
    there with password '03175987345'
    is 'peter' here
    mda "/usr/bin/procmail -d %T"
    options
    no keep
    ssl
    sslcertck
    sslcertpath /home/peter/.certs/


## really good mutt tutorial
#
http://mutt.blackfish.org.uk/sending/

## mutt works perfectly
if you don't have :

set sendmail="/usr/bin/msmtp"

in your .muttrc

mutt will by default use sendmail, [mutt does not talk smtp](http://mutt.blackfish.org.uk/sending/)

now my .muttrc is just these lines, and things works perfectly for me:

    # set from 
    set realname = "Peter Wang" 
    set from = "happypeter1983@gmail.com"
    set use_from = yes
    set envelope_from ="yes"


    # vim of course!
    set editor="vim -c 'set tw=70 et' '+/^$' "
    set edit_headers=yes      # See the headers when editing

so now I have my fetchmail to get all mails for me throw POP, and then I sendmail with my local machine,  but pretend 
to be happypeter1983@gmail.com by the settings in .muttrc, everything works really fast.

## the real monster

Q: what happened when I see `fetchmail -v` worked well, while in mutt I saw `no mailbox`?

A: there is this in .muttrc

        # If not set in ~/.bashrc:
        set spoolfile = /var/spool/mail/peter

   but for some reason fetchmail save all mail in /var/mail/peter(peter is a file not dir)

        peter@vostro:/var/spool$ sudo ln -s ../mail/

problem solved


#sendmail
http://seanbehan.com/linux/using-sendmail-to-send-mail-on-ubuntu-box/

check which port is available:

    http://www.mxtoolbox.com/

http://rimuhosting.com/support/settingupemail.jsp?mta=sendmail&t=dns#dns

nmap happypeter.org

now how to open port 25 for smtp?

Q: on ubuntu, sendmail does work-out-of box, but if I sendmail on cow or server-me, my  mail will end up putting in spam box, because of the "domain name is not qualitfied". on lover, no such problem, but when I try to use mutt to pretend to be happypeter1983@gmail.com, the resiver gmail will think I am a cheater, and report a error, so what to do? 

## sendmail on mac

it works out of box, but I do not have a real IP and HOST Name for imac, so the mail will be put in Spambox. That's but natural.

## open stmp to the internet (from vbird book)

backup first

    root@lover:/etc/mail# cp sendmail.mc sendmail.mc.peter.bak

now edit sendmail.mc:

        +DAEMON_OPTIONS(`Family=inet,  Name=MTA-v4, Port=smtp, Addr=0.0.0.0')dnl
        -DAEMON_OPTIONS(`Family=inet,  Name=MTA-v4, Port=smtp, Addr=127.0.0.1')dnl

regenerate sendmail.cf, the error does not matter:

    root@lover:/etc/mail# mv sendmail.cf sendmail.cf.peter.bak
    root@lover:/etc/mail# m4 sendmail.mc >sendmail.cf
    *** ERROR: FEATURE() should be before MAILER()
    *** MAILER(`local') must appear after FEATURE(`always_add_domain')*** ERROR: FEATURE() should be before MAILER()
    *** MAILER(`local') must appear after FEATURE(`allmasquerade')*** ERROR: FEATURE() should be before MAILER()

restart:

    root@lover:/etc/mail# /etc/init.d/sendmail restart

now check it port 25 is opened to all:

    root@lover:/etc/mail# netstat -tlunp

go to another machine and check:

    nmap happypeter.org

and now I see port 25 is opened, done!

now in local-host-names:
change
    
    lover.happypeter.org
into
    happypeter.org

resart sendmail again.

now I can send from gmail to peter@happypeter.org, the mail will be stored in /var/mail/peter

but want I try to send mail, the resiver still see <peter@lover.happypeter.com>, which is bad.


# other stuff
## evolution
is just like outlook

the nice thing to  have it is that I can bind my gmail account to it
, using it as a email client

configed according to https://help.ubuntu.com/community/UsingGmailWithEvolution
now I can click on a email-address on webpages and send email directly

## use mutt as a simple gmail client 


cat ~/.muttrc

    set imap_user = "happypeter1983@gmail.com"
    set imap_pass = "03175987345"

    set smtp_url = "smtp://happypeter1983@smtp.gmail.com:587/"
    set smtp_pass = "03175987345"
    set from = "happypeter1983@gmail.com"
    set realname = "peter wang"

    set folder = "imaps://imap.gmail.com:993"
    set spoolfile = "+INBOX"
    set postponed="+[Gmail]/Drafts"

    set header_cache=~/.mutt/cache/headers
    set message_cachedir=~/.mutt/cache/bodies
    set certificate_file=~/.mutt/certificates

    set move = no

http://shreevatsa.wordpress.com/2007/07/31/using-gmail-with-mutt-the-minimal-way/

I don't really love this approach, tooo slow

# FAQ
Q: now the problem is I mistakenly deleted some of the mail, now I want to retrieve them again, but I could not.
try to set option from "no keep"=>"keep", and use `fetchmail -a` simply won't work, why?

A: enable gmail POP setting:

    Enable POP for all mail (even mail that's already been downloaded)


